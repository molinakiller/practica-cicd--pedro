pipeline {
    agent {
        label('terraform-agent')
    }
    stages {

        stage('Credentials'){
            enviroment {
                CREDS = credentials('google-cloud-credentials')
            }
        }

        stage('Init') {
            steps {
                dir('terraform') {
                    sh 'terraform init -upgrade'
                }
            }
        }

        stage('Build'){
	        steps{
	            dir('terraform'){
		            sh 'terraform apply --auto-approve'
		        }
	        }
	    }

    }
}

